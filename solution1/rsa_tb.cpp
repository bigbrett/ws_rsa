#include <stdlib.h>
#include <iostream>
#include <cmath>
#include <bitset>
#include "globals.hpp"
#include "montMult.hpp"
#include "rsaModExp.hpp"
#include "interleaveModMult.hpp"


int main()
{
	uintRSA_t returnval = 0;

#define sel 1

#if sel==0
	uintRSA_t M =    uintRSA_t("00be5416af9696937b7234421f7256f78dba8001c80a5fdecdb4ed761f2b7f955946ec920399f23ce9627f66286239d3f20e7a46df185946c6c8482e227b9ce172dd518202381706ed0f91b53c5436f233dec27e8cb46c4478f0398d2c254021a7c21596b30f77e9886e2fd2a081cadd3faf83c86bfdd6e9daad12559f8d2747",16);
	uintRSA_t e =    uintRSA_t("6f1e6ab386677cdc86a18f24f42073b328847724fbbd293eee9cdec29ac4dfe953a4256d7e6b9abee426db3b4ddc367a9fcf68ff168a7000d3a7fa8b9d9064ef4f271865045925660fab620fad0aeb58f946e33bdff6968f4c29ac62bd08cf53cb8be2116f2c339465a64fd02517f2bafca72c9f3ca5bbf96b24c1345eb936d1",16);
	uintRSA_t n =    uintRSA_t("b4d92132b03210f62e52129ae31ef25e03c2dd734a7235efd36bad80c28885f3a9ee1ab626c30072bb3fd9906bf89a259ffd9d5fd75f87a30d75178b9579b257b5dca13ca7546866ad9f2db0072d59335fb128b7295412dd5c43df2c4f2d2f9c1d59d2bb444e6dac1d9cef27190a97aae7030c5c004c5aea3cf99afe89b86d6d",16);
	uintRSA_t Mbar = uintRSA_t("9A9D95D8EE88E38C18FF90DCDDFA8D8B59E8E3457F635660241E4B0CB01AD15CFDB7727BE260BA7254001D0D1B0DF4335927FE9332B9409A3B3D8F6DA56DE4ED030A9DAF7364871E5E46A01E174D36BEF53BB2C823A3301027168A23E67F5ABE4F7E1C3B2D75862C822D1B26593402E8835719CA67428A1F4020F14379EBB84D",16);
	uintRSA_t xbar = uintRSA_t("4B26DECD4FCDEF09D1ADED651CE10DA1FC3D228CB58DCA102C94527F3D777A0C5611E549D93CFF8D44C0266F940765DA600262A028A0785CF28AE8746A864DA84A235EC358AB97995260D24FF8D2A6CCA04ED748D6ABED22A3BC20D3B0D2D063E2A62D44BBB19253E26310D8E6F5685518FCF3A3FFB3A515C306650176479293",16);
	int ans = 29;

	if (NUM_BITS != 1024)
	{
		cerr << "Incorrect bitwidth specified" << endl;
		return 1;
	}
#elif sel==1
	uintRSA_t M =    uintRSA_t("99edc729fcacffd12791c6fca9bbf0a2ef94eb30306279d1247525e5d91c99dd9ec25d8ccd5f4d32a4deb7ad86927ec4b905857705842384ebc45ac25f571e4fbdc070222e8dbf47cc471aac7d52d490016e1a97f5d9c585f8898b1655cdfa0adc322ee2851ed7146529fe74f71bb75b3469f8b5d1947b5548c352640a0a0ce0",16);
	uintRSA_t e =    uintRSA_t("10020cf19dd87c0750321f7f94b6bc04c2ad8228638fda6029620311b9dc42646e6fb56f07f12ca257383ff9f17149ea729d220cda74cd796720767e7812499f56843f23a46addd14a444f0d4c342c97f8ad89c65697f2d283616cfd271ffac7d39ac101033352d1a2686b71a6e4970c1094afacd694f64babfb440f46b33671",16);
	uintRSA_t n =    uintRSA_t("00f54aef851ae186b8b9e0422e94759960d3c88129392d112de4f4b6e6bca9864bd379eabc62e48f9f81432b49684806ed6ab249bd975a512cfcb32eec1a245fa232b42a382b010c855cfbdc865f44782664dffb6e4a544fe44056944d748173c1839e4db166dc96b8840056273691eb0e1a1c8f9447251e3c93f9c5443e07b761",16);
	uintRSA_t Mbar = uintRSA_t("5D1C86B1D4F24E5B418017A358DB29D8BEF600BAE0CA63524BE7E578122D7BF3C12165670A28BFAF7CFA8F8E7B4AB2FF06A838DF3E83F8CE21E5CADD3B0FE3AE91C4C902666969657A35E3C698C4A73B438996C44C9703531C59D2551F34AC41CEA7BFE8E8BDCB655743790F87ACF18EA68BE78F0F9A06FD31FF4841DBC4F25",16);
	uintRSA_t xbar = uintRSA_t("AB5107AE51E7947461FBDD16B8A669F2C377ED6C6D2EED21B0B4919435679B42C8615439D1B70607EBCD4B697B7F912954DB64268A5AED3034CD113E5DBA05DCD4BD5C7D4FEF37AA3042379A0BB87D99B200491B5ABB01BBFA96BB28B7E8C3E7C61B24E992369477BFFA9D8C96E14F1E5E3706BB8DAE1C36C063ABBC1F8489F",16);
	int ans = 29;

	if (NUM_BITS != 1024)
	{
		cerr << "Incorrect bitwidth specified" << endl;
		return 1;
	}
#elif sel==2
	uintRSA_t M =    uintRSA_t("7f1ed3e1cd78ea337b6c54c0187220fa8f17f1dccf88884cc6d2ce90f90091183377a2974395b811427f15f6a970709eb9336224b382535388822bf84d296b97b3e587072503ad3fc68b378c0a3546cae4c18ff337ead7630423238c72abb60611542fb3a63fc13ac6b6eec9cd744084393a1d8f7d29415408b7ce8c0ff0884c",16);
	uintRSA_t e =    uintRSA_t("455d679aff5df43192c6f73ec715a6070dcf1f8edf79efad134506e4e6435e16ac50195302833e864595ffed9df71baa13fe235c0148a37bcc650621926d95fc4ce091d067541ac23fe46f0d7daa56368b2e7915df9c4462d051bb0ea8e4c1a61ad2eed13fd9187360072d8a577aacb2ea9f3084ca86c482c9df24e536af1bf1",16);
	uintRSA_t n =    uintRSA_t("b9fd69a48840b92bdfd488b8d2dccc7f514741c677c95c234e787898221afbefc5152739b5734904a16cb672fae01d2be1ab93185e657a5bf55e04a2b9f6a9688719340fffaa133533cbacaf4551491ffebcd674a5af78f1a3197865c43c7e87ee19a24c9c67376908d9740cb59381bb9a4de6121271430fec763837e5ff11d3",16);
	uintRSA_t Mbar = uintRSA_t("b361a02dbd278ea6c2d52d2880f7cdef3fecb2f69a164b0ad345a1d739440631a7aa5a470b1d9f566fd74bde1c0cec7267bc9de76a98bf4c6fa8187c123a1b2ebe756dd58b30401ae553449f10e6b0ca3413d279edbe4bb4084492e7c37e55d5eb3937f1e35bffb8ee7a8410941c6ecbc8c45fb8f6e16484c1441d43f23f3d39",16);
	uintRSA_t xbar = uintRSA_t("4602965b77bf46d4202b77472d233380aeb8be398836a3dcb1878767dde504103aead8c64a8cb6fb5e93498d051fe2d41e546ce7a19a85a40aa1fb5d4609569778e6cbf00055eccacc345350baaeb6e00143298b5a50870e5ce6879a3bc3817811e65db36398c896f7268bf34a6c7e4465b219eded8ebcf01389c7c81a00ee2d",16);
	int ans = 0x6DAFFF;

	if (NUM_BITS != 1024)
	{
		cerr << "Incorrect bitwidth specified" << endl;
		return 1;
	}
#elif sel==3
		uintRSA_t M   = 2790;
		uintRSA_t e   = 2753;
		uintRSA_t n   = 3233;
		uintRSA_t Mbar = 1330;
		uintRSA_t xbar = 1785;
		int ans = 65;

		if (NUM_BITS != 1024)
		{
			cerr << "Incorrect bitwidth specified" << endl;
//			return 1;
		}
#elif sel == 4
		uintRSA_t M   = 1570;
		uintRSA_t e   = 1019;
		uintRSA_t n   = 3337;
		uintRSA_t Mbar = 1966;
		uintRSA_t xbar = 2216;
		int ans = 688;

		if (NUM_BITS != 1024)
		{
			cerr << "Incorrect bitwidth specified" << endl;
			return 1;
		}
#else
		uintRSA_t M   = 7;
		uintRSA_t e   = 10;
		uintRSA_t n   = 13;
		uintRSA_t Mbar = 8;
		uintRSA_t xbar = 3;
		int ans = 4;

		if (NUM_BITS != 4)
		{
			cerr << "Incorrect bitwidth specified" << endl;
			return 1;
		}
#endif



//	uintRSA_t Mbar0=0,xbar0;
//	ap_uint<NUM_BITS+1> r = ap_uint<NUM_BITS+1>("10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",16);
//	interleaveModMult(r,M,n,&Mbar0);
//	interleaveModMult(r,ap_uint<NUM_BITS>(1),n,&xbar0);
//
//	if ((Mbar0 != Mbar) || (xbar0 != xbar))
//	{
//		cout << "FAILURE" << endl;
//		returnval = 1;
//	}
//	else
//		cout << "SUCCESS!" << endl;

	uintRSA_t res;
	rsaModExp(M,e,n,&res);


	// Read output from DUT function
	cerr << "res = " << hex << res << endl << " [ 0b" << bitset<10>(res) << " ]" << endl;


	if (res != ans)
	{
		cout << "Test Failed !!!" << endl;
		returnval = 1;
	}
	else
		cout << "Test Passed !!!" << endl;

		return returnval;
}

